# Система анализа подозрительных государственных закупок

## Описание проекта

Данная система представляет собой интерпретируемую модель машинного обучения, предназначенную для выявления подозрительных государственных закупок на основе различных характеристик сделок и поставщиков. Проект включает как скрипты для обучения модели, так и веб-приложение на Streamlit для удобного анализа закупок через пользовательский интерфейс.

## Требования к системе

### Версии Python:
- **Рекомендуемая версия:** Python 3.8-3.10
- **Не поддерживается:** Python 3.11+ (из-за несовместимости с некоторыми зависимостями)

### Операционные системы:
- Windows
- Linux
- macOS

## Возможности системы

- **Базовая модель:** Обучение и сохранение модели для определения подозрительных закупок
- **Веб-интерфейс:** Пользовательский интерфейс на базе Streamlit
- **Массовый анализ:** Загрузка CSV файла с данными о закупках для массового анализа
- **Проверка вручную:** Проверка отдельной закупки путем ввода ее параметров с мгновенным результатом
- **Визуализации:** Графики, показывающие важность признаков, метрики модели и распределение результатов
- **Средняя статистика:** Сравнение средних показателей подозрительных и обычных закупок
- **Интерактивная карта регионов:** Визуализация распределения подозрительных закупок по регионам Казахстана с возможностью анализа различных метрик

## Структура проекта

- `suspicious_purchases_model.py` - основной скрипт модели
- `app_streamlit.py` - веб-приложение на Streamlit
- `analyze_results.py` - скрипт для анализа результатов модели
- `final_training_data.csv` - обучающий набор данных
- `final_test_data_user_input.csv` - тестовый набор данных для предсказаний
- `predictions.csv` - файл с результатами предсказаний
- `model.pkl` - сохраненная модель
- `encoders.pkl` - сохраненные кодировщики для категориальных переменных
- `confusion_matrix.png` - визуализация матрицы ошибок модели
- `feature_importance.png` - визуализация важности признаков по XGBoost
- `shap_importance.png` - визуализация SHAP важности признаков
- `shap_summary.png` - визуализация SHAP распределения влияния признаков
- `probability_distribution.png` - визуализация распределения вероятностей предсказаний
- `requirements.txt` - файл с зависимостями проекта
- `uploads/` - директория для загруженных пользовательских файлов
- `static/` - директория для статических ресурсов (логотип и т.д.)

## Используемые признаки

1. **Характеристики закупки:**
   - `category` - категория закупки
   - `region` - регион проведения закупки
   - `price` - общая стоимость контракта
   - `avg_price_category_region` - средняя стоимость контрактов в данной категории и регионе
   - `price_per_unit` - цена за единицу товара/услуги
   - `days_to_tender` - количество дней до тендера

2. **Характеристики поставщика:**
   - `supplier_id` - идентификатор поставщика
   - `supplier_name` - название поставщика
   - `supplier_win_count` - количество выигранных контрактов поставщиком
   - `supplier_years_active` - количество лет активности поставщика
   - `supplier_total_contracts` - общее количество контрактов поставщика
   - `supplier_avg_contract_value` - средняя стоимость контрактов поставщика

## Целевая переменная

- `is_suspicious` - показатель подозрительности закупки (1 - подозрительная, 0 - не подозрительная)

## Используемые технологии

- **Streamlit:** Фреймворк для создания веб-приложений для машинного обучения и анализа данных
- **XGBoost:** Алгоритм машинного обучения для классификации
- **SHAP:** Библиотека для объяснения предсказаний моделей машинного обучения
- **Pandas, NumPy:** Библиотеки для обработки данных
- **Matplotlib, Seaborn:** Библиотеки для визуализации данных
- **Scikit-learn:** Библиотека для машинного обучения

## Возможности веб-интерфейса

### 1. Главная страница
Предоставляет общую информацию о проекте, демонстрирует метрики модели и описывает используемые признаки.

### 2. Загрузка файла
Возможность загрузить CSV файл для массового анализа закупок. Отображает статистику, выявленные подозрительные закупки и распределение вероятностей.

### 3. Проверка вручную
Интерфейс для ввода параметров отдельной закупки с мгновенным результатом анализа и объяснением предсказания с помощью SHAP.

### 4. Визуализации
Различные графики и метрики для оценки работы модели:
- Метрики качества модели
- Важность признаков (SHAP)
- Распределение вероятностей предсказаний

### 5. Карта регионов
Интерактивная карта Казахстана с визуализацией подозрительных закупок по регионам:
- Отображение различных метрик (количество, процент, сумма подозрительных закупок)
- Тепловая карта подозрительности
- Таблица с подробными данными по регионам
- Сравнительные графики регионов

## Установка и запуск

### 1. Установка Python 3.10 (рекомендуется)

Скачайте и установите Python 3.10 с [официального сайта](https://www.python.org/downloads/release/python-3108/).

Для Windows:
- Выберите "Windows installer (64-bit)"
- При установке отметьте галочку "Add Python to PATH"

### 2. Создание виртуального окружения

#### Для Windows:

```bash
# Проверить доступные версии Python:
py -0

# Создать виртуальное окружение с Python 3.10:
py -3.10 -m venv venv_py310

# Активировать виртуальное окружение:
venv_py310\Scripts\activate
```

#### Для Linux/macOS:

```bash
# Создать виртуальное окружение:
python3.10 -m venv venv_py310

# Активировать виртуальное окружение:
source venv_py310/bin/activate
```

### 3. Установка зависимостей

```bash
# Установить все необходимые зависимости:
pip install -r requirements.txt
```

### 4. Запуск проекта

#### Запуск веб-приложения Streamlit:

```bash
streamlit run app_streamlit.py
```
После запуска веб-приложения откройте веб-браузер и перейдите по адресу: http://localhost:8501

#### Запуск базовой модели для обучения:

```bash
python suspicious_purchases_model.py
```

#### Запуск анализа результатов:

```bash
python analyze_results.py
```

### Альтернативная установка для Python 3.11+ 

Если у вас установлен Python 3.11 или новее, вы можете обновить файл requirements.txt со следующими версиями (однако работа всех функций не гарантирована):

```
streamlit==1.28.0
pandas==2.1.0
numpy==1.24.0
matplotlib==3.7.3
seaborn==0.12.2
scikit-learn==1.3.0
xgboost==2.0.0
shap==0.43.0
plotly==5.18.0
pillow==10.0.0
joblib==1.3.2
scipy==1.11.3
```

## Метрики модели

- **Точность (accuracy):** 96.1%
- **Точность (precision):** 98.5%
- **Полнота (recall):** 77.4%
- **F1-мера:** 86.7%

## Формат входных данных

Система принимает CSV файлы со следующими колонками:
- `category`: Категория закупки
- `region`: Регион проведения закупки
- `price`: Стоимость контракта
- `avg_price_category_region`: Средняя стоимость по категории и региону
- `supplier_id`: Идентификатор поставщика
- `supplier_name`: Название компании поставщика
- `supplier_win_count`: Количество выигранных контрактов
- `days_to_tender`: Дни до тендера
- `price_per_unit`: Цена за единицу
- `supplier_years_active`: Годы активности поставщика
- `supplier_total_contracts`: Общее количество контрактов
- `supplier_avg_contract_value`: Средняя стоимость контрактов

## Результаты и интерпретация

После запуска модели будут созданы:
- Файл `predictions.csv` с предсказаниями на тестовом наборе данных
- Визуализации для анализа работы модели

Модель использует XGBoost с SHAP (SHapley Additive exPlanations) для обеспечения интерпретируемости результатов. SHAP позволяет понять, какие признаки наиболее важны для принятия решения о подозрительности закупки и как конкретные значения признаков влияют на предсказания модели.

## Решение проблем

### Проблемы с установкой зависимостей:
- Если у вас Python 3.11+, следуйте инструкциям для альтернативной установки
- При возникновении ошибок с SHAP или XGBoost, убедитесь, что используете Python 3.10 или ниже
- Проблемы с NumPy часто возникают из-за несовместимости версий Python

### Проблемы запуска Streamlit:
- Убедитесь, что все зависимости установлены правильно
- Проверьте, что активировано правильное виртуальное окружение

## Примечания

Проект разработан для Python 3.8-3.10 и использует совместимые версии всех библиотек. При возникновении проблем с установкой или запуском, рекомендуется создать новое виртуальное окружение с Python 3.10. 